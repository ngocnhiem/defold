# Defold 1.12.0

## Summary
* __BREAKING CHANGE__: ([#11491](https://github.com/defold/defold/pull/11491)) Rearrange component's update (by ekharkunov)
* __NEW__: ([#11386](https://github.com/defold/defold/pull/11403)) Added new camera functions for converting between world and screen coordinates.   (by AGulev)
* __NEW__: ([#8309](https://github.com/defold/defold/pull/11445)) Added engine throttle performance Lua api (by JCash)
* __NEW__: ([#9981](https://github.com/defold/defold/pull/11285)) Add sys.get_config_boolean() (by appsoluut)
* __NEW__: ([#10948](https://github.com/defold/defold/pull/11448)) Added support for .astc texture format in gui.new_texture() (by JCash)
* __NEW__: ([#7277](https://github.com/defold/defold/pull/11512)) Introduce `late_update` script function (by ekharkunov)
* __NEW__: ([#8763](https://github.com/defold/defold/pull/11427)) Added sound group mute functionality to C++ dmSDK (by deurell)
* __NEW__: ([#11184](https://github.com/defold/defold/pull/11367)) WelcomeScreen: Enter keybinding to open selected project (by JosephFerano)
* __NEW__: ([#11334](https://github.com/defold/defold/pull/11407)) Check ENV and validate DM_SERVICE_PORT (by JosephFerano)
* __NEW__: ([#3868](https://github.com/defold/defold/pull/11385)) Save and Restore open tabs (by JosephFerano)
* __NEW__: ([#10999](https://github.com/defold/defold/pull/11518)) Build runtime-generated fonts from the editor (by matgis)
* __NEW__: ([#11508](https://github.com/defold/defold/pull/11508)) Improve Model rendering performance in Scene View (by matgis)
* __FIX__: ([#10971](https://github.com/defold/defold/pull/11072)) New sound backend for iOS and macOS: AVAudio (by AGulev)
* __FIX__: ([#11416](https://github.com/defold/defold/pull/11434)) Make sure ASTC used in maximum possible cases in HTML5 bundle (by AGulev)
* __FIX__: ([#10312](https://github.com/defold/defold/pull/11357)) Fixed Crash when using raycasts under certain conditions (by DarkRavenStar)
* __FIX__: ([#11464](https://github.com/defold/defold/pull/11485)) Add astc encoding context destruction to deallocate memory (by JCash)
* __FIX__: ([#9917](https://github.com/defold/defold/pull/11498)) Fix frustrum culling for sprites with pivot point  (by ekharkunov)
* __FIX__: ([#11519](https://github.com/defold/defold/pull/11519)) ASTC encoder fixes (by AGulev)
* __FIX__: ([#11354](https://github.com/defold/defold/pull/11354)) Update Java version to 25 (by vlaaad)
* __FIX__: ([#11379](https://github.com/defold/defold/pull/11414)) Allow typing tilde (`~`) on Swedish keyboard layout (by vlaaad)
* __FIX__: ([#11377](https://github.com/defold/defold/pull/11412)) Repaint up to last visible minimap row (by JosephFerano)
* __FIX__: ([#10891](https://github.com/defold/defold/issues/10891)) Changing font size via hotkeys does not work (by Klaleus)
* __FIX__: ([#11400](https://github.com/defold/defold/pull/11428)) Show errors from exceptions thrown during tile source texture layout (by matgis)
* __FIX__: ([#11166](https://github.com/defold/defold/pull/11442)) Produce user-friendly build errors from invalid Tile Sources (by matgis)
* __FIX__: ([#11452](https://github.com/defold/defold/pull/11455)) Fix exceptions from removed nodes when getting overridden properties (by matgis)
* __FIX__: ([#11457](https://github.com/defold/defold/pull/11457)) Localize resource type labels (by vlaaad)
* __FIX__: ([#11465](https://github.com/defold/defold/pull/11465)) Localize form views (by vlaaad)
* __FIX__: ([#11462](https://github.com/defold/defold/pull/11484)) Fix editor exception when double-clicking on a Build Error from a resource with an empty Outline  (by matgis)
* __FIX__: ([#11487](https://github.com/defold/defold/pull/11487)) Localize editor scripts and bundle dialogs (by vlaaad)
* __FIX__: ([#11461](https://github.com/defold/defold/pull/11489)) Fix outline re-ordering (by vlaaad)
* __FIX__: ([#802](https://github.com/defold/extender/pull/804)) Update JDK to 25 (Docker image only). Remove old Dockerfiles (by ekharkunov)
* __FIX__: ([#801](https://github.com/defold/extender/pull/803)) Fix PodBuildSpec creation when PodSpec has more than 2 level of subspecs (by ekharkunov)
* __FIX__: ([#806](https://github.com/defold/extender/pull/810)) Rework health report collection (by ekharkunov)
* __FIX__: ([#807](https://github.com/defold/extender/pull/809)) Fix sdk mapping download when mapping doesn't exist initially (by ekharkunov)
* __FIX__: ([#771](https://github.com/defold/extender/pull/811)) Change how contexts are merged (by ekharkunov)
* __FIX__: ([#465,#720](https://github.com/defold/extender/pull/712)) Implemented instance type (by ekharkunov)

## Engine
__BREAKING CHANGE__: ([#11491](https://github.com/defold/defold/pull/11491)) __'Rearrange component's update'__ by ekharkunov
⚠️ ⚠️ ⚠️ **Possible breaking change** ⚠️ ⚠️ ⚠️
* `FixedUpdate` moved before regular `Update`. It means that all transform's changes introduced by physics components will be applied before execution of regular component's `Update`.
* Order of lua callbacks `update(self)` and `fixed_update(self)` stays the same as it was before.

__NEW__: ([#11386](https://github.com/defold/defold/pull/11403)) __'Added new camera functions for converting between world and screen coordinates.  '__ by AGulev
Adds three camera-space conversion helpers to the Lua `camera` module:
  - `camera.world_to_screen(world_pos, [camera])`
  - `camera.screen_xy_to_world(x, y, [camera])`
  - `camera.screen_to_world(pos, [camera])`
```lua
-- Place objects at the touch point.
function on_input(self, action_id, action)
    if action_id == hash("touch") then
        if action.pressed then
            local world_position = camera.screen_xy_to_world(action.screen_x, action.screen_y)
            go.set_position(world_position, "/go1")
        end
    end
end
```

```lua
-- Place objects at the touch point with a random Z position, keeping them within the visible view zone.
function on_input(self, action_id, action)
    if action_id == hash("touch") then
        if action.pressed then
            local percpective_camera = msg.url("#perspective_camera")
            local random_z = math.random(camera.get_near_z(percpective_camera) + 0.01, camera.get_far_z(percpective_camera) - 0.01)
            local world_position = camera.screen_to_world(vmath.vector3(action.screen_x, action.screen_y, random_z), percpective_camera)
            go.set_position(world_position, "/go1")
        end
    end
end
```

```lua
-- Convert go position into screen position
go.update_world_transform("/go1")
local world_pos = go.get_world_position("/go1")
local screen_pos = camera.world_to_screen(world_pos)
```

__NEW__: ([#8309](https://github.com/defold/defold/pull/11445)) __'Added engine throttle performance Lua api'__ by JCash
This api allows the developer to skip engine updates altogether, except input detection.
* No update or rendering will occur once the engine is throttled
* Any input will wake up the engine again
* The engine will be throttled again after the cooldown period

Api:
```lua
sys.set_engine_throttle(false) -- No throttling, full engine updates + rendering (default)
sys.set_engine_throttle(true, 1.0) -- Throttling with a cooldown. Engine will wake up for 1 second after each input
sys.set_engine_throttle(true, 0.0) -- Throttling with a cooldown. Engine will wake up for 1 frame after each input.
```

__NEW__: ([#9981](https://github.com/defold/defold/pull/11285)) __'Add sys.get_config_boolean()'__ by appsoluut
Allow to get the config parameter as a boolean in Lua. Converts only `1` and `0` to their boolean counterparts.

__NEW__: ([#10948](https://github.com/defold/defold/pull/11448)) __'Added support for .astc texture format in gui.new_texture()'__ by JCash
This allows for using compressed textures in gui.

There are some restrictions on the input .astc file:
* Format should be RGBA
* The `flip` parameter is not supported, so make sure texture is already flipped

Example:
```lua
local path = "/assets/images/logo_4x4.astc"
local buffer = sys.load_resource(path)
local n = gui.new_box_node(pos, vmath.vector3(size, size, 0))
gui.new_texture(path, 0, 0, "astc", buffer, false)
gui.set_texture(n, path)
```

__NEW__: ([#7277](https://github.com/defold/defold/pull/11512)) __'Introduce `late_update` script function'__ by ekharkunov
New script function `late_update(self, dt)` was introduced. That function runs **after** regular `update(self, dt)` function. All in-games messages are dispacthed in between `update(self, dt)` and `late_update(self, dt)`. You can safely update game object's transforms in `late_update(self, dt)` because components will update inner transforms after script execution.

__NEW__: ([#8763](https://github.com/defold/defold/pull/11427)) __'Added sound group mute functionality to C++ dmSDK'__ by deurell
Add functionality to mute sound groups from extensions.

__FIX__: ([#10971](https://github.com/defold/defold/pull/11072)) __'New sound backend for iOS and macOS: AVAudio'__ by AGulev
This new backend replaces the deprecated OpenAL backend on iOS and macOS.

__FIX__: ([#11416](https://github.com/defold/defold/pull/11434)) __'Make sure ASTC used in maximum possible cases in HTML5 bundle'__ by AGulev
[Because of a Chromium-side issue](https://issues.chromium.org/issues/434983812), Defold uses a workaround that disables ASTC compression when the issue is detected, falling back to ETC2 - which offers lower visual quality.  

This update narrows the fallback to ETC2 so it only applies to **paged atlases** in affected cases.  
As a result, single-paged atlases now use ASTC for maximum texture quality, while multi-paged atlases remain visible even on devices impacted by the Chromium problem.

__FIX__: ([#10312](https://github.com/defold/defold/pull/11357)) __'Fixed Crash when using raycasts under certain conditions'__ by DarkRavenStar
This fixes a crash when the length of a 2D or 3D raycast is zero.
This fix specifically takes into account the case when the ray length becomes zero after applying the `physics.scale` setting in game.project.

__FIX__: ([#11464](https://github.com/defold/defold/pull/11485)) __'Add astc encoding context destruction to deallocate memory'__ by JCash
Added memory fix when using ASTC texture compression. It previously leaked memory after each compressed image.

__FIX__: ([#9917](https://github.com/defold/defold/pull/11498)) __'Fix frustrum culling for sprites with pivot point '__ by ekharkunov
Fixed culling for sprites with pivot points. Also implemented some optimization on how geometry data calculated and stored between batches. So now it should be a bit faster in terms of calculation but consume some memory to store cached information.

__FIX__: ([#11519](https://github.com/defold/defold/pull/11519)) __'ASTC encoder fixes'__ by AGulev
- Updated the ASTC encoder to version 5.3.0
- Enabled the release flag to ensure full performance
- Fixed the ASTC 4x4 RGB build


## Editor
__NEW__: ([#11184](https://github.com/defold/defold/pull/11367)) __'WelcomeScreen: Enter keybinding to open selected project'__ by JosephFerano
Currently pressing ENTER in the welcome screen to select a project doesn't do anything. This PR adds the ENTER keybinding so it opens the currently selected project.

__NEW__: ([#11334](https://github.com/defold/defold/pull/11407)) __'Check ENV and validate DM_SERVICE_PORT'__ by JosephFerano
Editor used to ignore `DM_SERVICE_PORT` and always use a dynamic port. Now the editor can read the port when the environment variable supplied.

__NEW__: ([#3868](https://github.com/defold/defold/pull/11385)) __'Save and Restore open tabs'__ by JosephFerano
Currently, when a user has open tabs and assigned to different panes, when they close the editor, they are all closed out and require opening them up again. This PR will restore all previous open tabs, in the correct order, and in the proper splits.

__NEW__: ([#10999](https://github.com/defold/defold/pull/11518)) __'Build runtime-generated fonts from the editor'__ by matgis
The editor now respects the `font.runtime_generation` setting in `game.project`. Previously only Bob would produce runtime-generated fonts when this setting was enabled for the project.

__NEW__: ([#11508](https://github.com/defold/defold/pull/11508)) __'Improve Model rendering performance in Scene View'__ by matgis
The editor responsiveness in scenes that feature Models has been drastically improved, especially when per-instance vertex attributes are involved.

Partially adresses #9817.

__FIX__: ([#11354](https://github.com/defold/defold/pull/11354)) __'Update Java version to 25'__ by vlaaad
Defold Java version is updated to 25 (from 21). If you are only using the editor, you don't need to do anything, but if you use bob.jar (e.g., in a CI pipeline), you'll need to update Java from 21 to 25.

The update gives us a small, but noticeable performance and memory use improvement:
- memory usage when opening a big project decreased by 5% (7.4Gb -> 7Gb)
- time to open a big project decreased by 17% (4m34s -> 3m47s)
- time to build a big project decreased by 10% (8m18s -> 7m20s)

__FIX__: ([#11379](https://github.com/defold/defold/pull/11414)) __'Allow typing tilde (`~`) on Swedish keyboard layout'__ by vlaaad
Now it's possible to enter the tilde character (`~`) when using the Swedish keyboard layout by pressing <kbd>⌥ ^</kbd> followed by space or another character.

__FIX__: ([#11377](https://github.com/defold/defold/pull/11412)) __'Repaint up to last visible minimap row'__ by JosephFerano
The minimap in the code editor wasn't syntax highlighting all the lines visible in larger files. Now the minimap will have syntax colors all the way through.

__FIX__: ([#10891](https://github.com/defold/defold/issues/10891)) __'Changing font size via hotkeys does not work'__ by Klaleus
**Describe the bug (REQUIRED)**

Pressing Ctrl++ while editing text does not increase font size, whereas pressing Ctrl+- does successfully decrease it.

**To Reproduce (REQUIRED)**
Steps to reproduce the behavior:
1. Enter the text editor.
2. Type something.
3. Test the hotkeys for increasing and decreasing font size.

**Expected behavior (REQUIRED)**

Hotkeys should work as intended.

**Defold version (REQUIRED):**

1.10.2

**Platforms (REQUIRED):**

Linux
Pop!_OS 24.04 LTS alpha

I recall this also being a problem on my Windows 11 machine, but I'm not certain.

**Workaround (OPTIONAL):**

Repeatedly pressing the increase and decrease menu items, which takes a lot of time.

__FIX__: ([#11400](https://github.com/defold/defold/pull/11428)) __'Show errors from exceptions thrown during tile source texture layout'__ by matgis


__FIX__: ([#11166](https://github.com/defold/defold/pull/11442)) __'Produce user-friendly build errors from invalid Tile Sources'__ by matgis
* All invalid properties in Tile Sources now generate clickable build errors.
* Highlight Tile Source Animations with invalid properties in the Outline View.
* Render errors in the Scene View will now report the source file when the error originates from a substructure node.
* Fixed Exception in the editor when setting the Tile Source Tile Margin to a negative value.
* Tile Source Tile Width and Height must be positive.
* The error tooltip for the Sprite Default Animation field now refers to the correct Image property label.

__FIX__: ([#11452](https://github.com/defold/defold/pull/11455)) __'Fix exceptions from removed nodes when getting overridden properties'__ by matgis


__FIX__: ([#11457](https://github.com/defold/defold/pull/11457)) __'Localize resource type labels'__ by vlaaad


__FIX__: ([#11465](https://github.com/defold/defold/pull/11465)) __'Localize form views'__ by vlaaad


__FIX__: ([#11462](https://github.com/defold/defold/pull/11484)) __'Fix editor exception when double-clicking on a Build Error from a resource with an empty Outline '__ by matgis
* Fixed exception in the editor if the user double-clicked a Build Error originating from a resource whose Outline view was empty after opened.
* Fixed empty Outline view for Tile Sources whose tile count couldn't be determined as a result of invalid property values. This was a regression introduced by #11442.

__FIX__: ([#11487](https://github.com/defold/defold/pull/11487)) __'Localize editor scripts and bundle dialogs'__ by vlaaad


__FIX__: ([#11461](https://github.com/defold/defold/pull/11489)) __'Fix outline re-ordering'__ by vlaaad
We introduced a regression in 1.11.2 during the outline refactor that made re-ordering behavior erratic. Now the issue is fixed.


## Other
__FIX__: ([#802](https://github.com/defold/extender/pull/804)) __'Update JDK to 25 (Docker image only). Remove old Dockerfiles'__ by ekharkunov
* Update JDK in base Docker image to 25
* Remove old Dockerfiles

__FIX__: ([#801](https://github.com/defold/extender/pull/803)) __'Fix PodBuildSpec creation when PodSpec has more than 2 level of subspecs'__ by ekharkunov


__FIX__: ([#806](https://github.com/defold/extender/pull/810)) __'Rework health report collection'__ by ekharkunov


__FIX__: ([#807](https://github.com/defold/extender/pull/809)) __'Fix sdk mapping download when mapping doesn't exist initially'__ by ekharkunov


__FIX__: ([#771](https://github.com/defold/extender/pull/811)) __'Change how contexts are merged'__ by ekharkunov


__FIX__: ([#465,#720](https://github.com/defold/extender/pull/712)) __'Implemented instance type'__ by ekharkunov
Errors about unsupported engine's version or platform become more clear.

